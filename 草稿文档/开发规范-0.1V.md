# 开发规范

## 代码风格规范

### 命名规范（Qt风格）
- **类名**：使用PascalCase，如`ChatClient`、`MessageHandler`
- **函数名**：使用camelCase，如`sendMessage()`、`connectToServer()`
- **变量名**：使用camelCase，如`messageList`、`connectionStatus`
- **常量**：使用UPPER_SNAKE_CASE，如`MAX_CONNECTIONS`、`DEFAULT_TIMEOUT`
- **私有成员**：使用下划线前缀，如`_socket`、`_isConnected`

### 文件组织
- **头文件**：使用`.h`扩展名，包含类声明和必要的包含
- **源文件**：使用`.cpp`扩展名，包含实现代码
- **QML文件**：使用`.qml`扩展名，遵循组件命名规范

### 代码格式
- 使用4个空格缩进（不使用Tab）
- 大括号采用K&R风格（左大括号不换行）
- 行长度限制在120字符以内
- 使用空行分隔逻辑块

## 架构设计原则

### SOLID原则
1. **单一职责原则（SRP）**：每个类只负责一个功能
2. **开闭原则（OCP）**：对扩展开放，对修改关闭
3. **里氏替换原则（LSP）**：子类可以替换父类
4. **接口隔离原则（ISP）**：客户端不应该依赖它不需要的接口
5. **依赖倒置原则（DIP）**：依赖抽象而不是具体实现

### 设计模式应用
- 优先使用组合而非继承
- 使用接口定义契约
- 采用依赖注入管理依赖关系

## 头文件管理

### 前置声明
```cpp
// 优先使用前置声明
class QSslSocket;
class QThreadPool;

// 避免在头文件中包含完整的类定义
#include <QSslSocket>  // 不推荐
```

### PIMPL模式
对于复杂的类，使用PIMPL（Pointer to Implementation）模式隐藏实现细节：

```cpp
// ChatClient.h
class ChatClientPrivate;
class ChatClient : public QObject
{
    Q_OBJECT
public:
    ChatClient(QObject *parent = nullptr);
    ~ChatClient();
    
private:
    ChatClientPrivate *d_ptr;
    Q_DECLARE_PRIVATE(ChatClient)
};
```

## 内存管理

### Qt对象树
- 使用Qt的对象树自动管理内存
- 父对象销毁时自动删除子对象
- 避免手动delete Qt对象

### 智能指针
- 使用`std::unique_ptr`管理独占资源
- 使用`std::shared_ptr`管理共享资源
- 避免使用裸指针

## 线程安全

### 信号槽连接
```cpp
// 跨线程连接使用Qt::QueuedConnection
connect(sender, &Sender::signal, 
        receiver, &Receiver::slot, 
        Qt::QueuedConnection);
```

### 互斥锁使用
```cpp
class ThreadSafeClass
{
private:
    mutable QMutex _mutex;
    QVariant _data;
    
public:
    QVariant getData() const
    {
        QMutexLocker locker(&_mutex);
        return _data;
    }
};
```

## 错误处理

### 异常处理
- 使用Qt的异常处理机制
- 避免在析构函数中抛出异常
- 使用RAII模式管理资源

### 日志记录
```cpp
// 使用Qt的日志系统
qDebug() << "Debug message";
qWarning() << "Warning message";
qCritical() << "Critical error";
```

## 性能优化

### 避免不必要的拷贝
```cpp
// 使用const引用传递参数
void processMessage(const QString &message);

// 使用移动语义
QString createMessage() &&;
```

### 缓存优化
- 缓存频繁访问的数据
- 使用`QCache`管理缓存
- 实现LRU淘汰策略

## 管理界面开发规范

### UI组件命名
```cpp
// 管理界面组件命名规范
class DashboardWidget : public QWidget  // 仪表板组件
class UserManagerWidget : public QWidget  // 用户管理组件
class SystemConfigWidget : public QWidget  // 系统配置组件
class LogViewerWidget : public QWidget  // 日志查看组件
```

### 数据模型设计
```cpp
// 管理界面数据模型
class AdminDataModel : public QAbstractTableModel
{
    Q_OBJECT
public:
    enum Roles {
        UserIdRole = Qt::UserRole + 1,
        UsernameRole,
        StatusRole,
        LastOnlineRole
    };
    
    QHash<int, QByteArray> roleNames() const override;
    int rowCount(const QModelIndex &parent = QModelIndex()) const override;
    QVariant data(const QModelIndex &index, int role = Qt::DisplayRole) const override;
};
```

### 实时数据更新
```cpp
// 使用定时器实现实时数据更新
class RealTimeMonitor : public QObject
{
    Q_OBJECT
public:
    RealTimeMonitor(QObject *parent = nullptr);
    
private slots:
    void updateStatistics();
    void refreshUserList();
    
private:
    QTimer *_updateTimer;
    QTimer *_userListTimer;
};
```

### 管理操作命令
```cpp
// 管理操作命令基类
class AdminCommand : public QObject
{
    Q_OBJECT
public:
    virtual void execute() = 0;
    virtual void undo() = 0;
    virtual QString description() const = 0;
    
signals:
    void commandExecuted();
    void commandFailed(const QString &error);
};
```

## 测试规范

### 单元测试
- 使用Qt Test框架编写单元测试
- 测试覆盖率目标：80%以上
- 每个公共接口都要有对应的测试用例

### 集成测试
- 测试模块间的交互
- 模拟网络异常情况
- 压力测试验证性能

### 管理界面测试
```cpp
// 管理界面测试示例
class AdminWindowTest : public QObject
{
    Q_OBJECT
private slots:
    void testUserManagement();
    void testSystemConfiguration();
    void testRealTimeMonitoring();
    void testLogViewer();
};
```

## 文档规范

### 代码注释
```cpp
/**
 * @brief 发送消息到服务器
 * @param message 要发送的消息内容
 * @param receiver 接收者ID
 * @return 发送是否成功
 */
bool sendMessage(const QString &message, const QString &receiver);
```

### API文档
- 使用Doxygen生成API文档
- 为每个公共接口编写文档
- 包含使用示例和注意事项

### 管理界面文档
```cpp
/**
 * @brief 管理界面主窗口类
 * 
 * 提供服务器后台管理功能，包括：
 * - 实时监控：在线用户、消息统计、系统资源
 * - 用户管理：用户信息查看、状态管理、权限配置
 * - 系统配置：服务器参数、数据库配置、安全策略
 * - 日志查看：实时日志流、日志过滤、日志导出
 */
class AdminWindow : public QMainWindow
{
    Q_OBJECT
public:
    explicit AdminWindow(QWidget *parent = nullptr);
    ~AdminWindow();
    
private slots:
    void onUserManagementClicked();
    void onSystemConfigClicked();
    void onLogViewerClicked();
    void onDashboardClicked();
};
```

## 版本控制

### Git规范
- 使用语义化提交信息
- 分支命名：`feature/功能名`、`bugfix/问题描述`
- 代码审查：所有代码必须经过审查才能合并

### 发布流程
1. 功能开发完成
2. 单元测试通过
3. 集成测试通过
4. 代码审查通过
5. 合并到主分支
6. 创建发布标签

## 管理界面部署规范

### 开发环境
```ini
# admin_dev.ini
[AdminUI]
port=8080
auto_refresh_interval=5000
log_level=DEBUG

[Security]
admin_username=admin
admin_password=dev_password
session_timeout=3600
```

### 生产环境
```ini
# admin_prod.ini
[AdminUI]
port=8443
auto_refresh_interval=10000
log_level=INFO

[Security]
admin_username=admin
admin_password=secure_password
session_timeout=1800
ssl_required=true
```

### 安全规范
- 管理界面必须使用HTTPS
- 实现会话超时机制
- 记录所有管理操作日志
- 支持多因素认证（可选） 