# QK Chat App 技术架构

## 服务器端技术选型

| 组件         | 技术选型                     | 说明                                                                 |
|--------------|-----------------------------|----------------------------------------------------------------------|
| 网络通信     | `QSslServer`                | **⚠️ 替换QTcpServer**，支持TLS 1.3加密通信，证书自动续期机制            |
| 协议解析     | 自定义二进制协议解析器        | 包头结构优化：**✅ 增加心跳标志位(1B)** + 消息类型(2B) + 消息长度(4B) + 消息体 |
| 数据库       | MySQL + QtSql模块           | 表结构增强：<br>- 用户表 **✅ 增加last_online字段**<br>- 消息表 **✅ 增加delivery_status状态字段** |
| 加密         | `QCryptographicHash(SHA-256)` + **✅ OpenSSL** | **⚠️ 强制启用TLS**，采用ECDHE-RSA-AES256-GCM加密套件                 |
| 文件传输     | 独立`QSslServer`端口        | **✅ 增加区块索引表**记录传输进度，**⚠️ 支持零拷贝(QFile::map)**         |
| 多线程       | `QThreadPool` + 任务队列     | **⚠️ 设置线程上限**：`QThreadPool::setMaxThreadCount(CPU核心数×2 + 1)` |
| **后台管理**  | **QWidget + QML混合界面**   | **✅ 新增Qt后台管理界面**：实时监控、用户管理、系统配置、日志查看        |

## 客户端技术选型

| 组件         | 技术选型                     | 说明                                                                 |
|--------------|-----------------------------|----------------------------------------------------------------------|
| 网络层       | `QSslSocket`                | **⚠️ 替换QTcpSocket**，自动验证服务器证书链                          |
| UI框架       | QWidget + QML               | **✅ 新增心跳计时器**：30秒无活动触发自动重连                        |
| 数据缓存     | SQLiteCipher加密            | **✅ 增加缓存淘汰策略**：LRU自动清理90天前旧消息                     |
| 文件传输     | 分块校验(MD5) + 断点续传     | **⚠️ 集成区块索引持久化**，意外退出后可恢复传输                      |
| 多线程       | `QFuture` + `QtConcurrent`  | **✅ 增加传输带宽限制器**：防止大文件占用全部网络带宽                |

## 功能概述

QK Chat App（Qt 6）主要功能：
1. 登录认证
2. 好友聊天
3. 群聊
4. 文件传输
5. **服务器后台管理**（新增）

注：目前客户端和服务器端都暂时在同一台本地计算机进行开发和测试（以后服务器端将会部署在远程服务器上） 